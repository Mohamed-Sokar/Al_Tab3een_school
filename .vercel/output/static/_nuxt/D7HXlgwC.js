import{k as De,$ as Ie,v as b,g as U,c,o as i,b as n,a as t,i as ce,w as _,K as S,j as s,G as Ue,H as Ke,t as r,a0 as $,Y as Ve,ac as Te,a1 as x,X as G,_ as ze}from"./Bdt3oPQx.js";import{_ as Fe}from"./Dlsi226R.js";import{_ as Ne}from"./Bn0lJZWP.js";import{_ as Be}from"./BxXEQc89.js";import{_ as Me}from"./TqmmhZlW.js";import{c as ie,b as de,_ as Ae}from"./DNUGNUt7.js";import{_ as Pe}from"./ByrGOqPk.js";import{_ as Ee}from"./DJc-qFf6.js";import{_ as Ge}from"./5e5F26OJ.js";import{u as Qe}from"./BV0LrqSL.js";import{u as He}from"./BXPk3F4g.js";import{u as Le}from"./Cjavoy-t.js";import{u as Re}from"./qE0mH2sV.js";import"./By-TetZO.js";import"./Bp9vj24c.js";import"./vVQ4po60.js";import"./CHIgUVhi.js";import"./CwNombFT.js";import"./BNDzZfAd.js";import"./1rqy2HNY.js";import"./CnqViFtj.js";import"./CehikpY4.js";import"./CdmufGkO.js";const Oe={key:0},Xe={key:0},Ye={class:"pt-3"},Je={class:"font-bold"},We={key:1},Ze={key:1},es={key:0},ss={class:"grid grid-cols-4 justify-between items-center gap-2 py-2"},ts={class:"font-bold"},ls={class:"font-bold"},as={class:"font-bold"},os={class:"font-bold"},ns={key:1},rs={key:2},is={key:0},ds={class:"grid grid-cols-4 justify-between items-center gap-2 py-2"},cs={class:"font-bold"},us={class:"font-bold"},ps={class:"font-bold"},fs={class:"font-bold"},ms={key:1},_s={key:3},gs={key:0},vs={class:"grid grid-cols-4 justify-between items-center gap-2 py-2"},bs={class:"font-bold"},ys={class:"font-bold"},hs={class:"font-bold"},ws={class:"font-bold"},Ss={key:1},$s={key:4},ks={class:"flex gap-3 items-center"},qs={key:5},Cs={class:"flex gap-3 items-center"},xs={key:6},js={class:"flex gap-3 items-center"},Ds={class:"w-full flex justify-between gap-2 mt-5 mb-5"},Is={key:0,class:"flex items-center justify-end gap-2"},Us=De({__name:"main",setup(ue){const T=ie({selectedClassId:de().required("الصف مطلوب")}),z=ie({selectedDriverId:de().required("السائق مطلوب")}),g=Qe(),F=Le(),N=He(),B=Re(),k=Ie(),f=Ve,pe=Fe,K=Ne,M=b([{id:"id",desc:!1}]),j=b(),fe=b(),me=b(Math.random()),h=b({}),d=b(),w=b(!1),u=b(),m=b(void 0),q=b(void 0),_e=[{accessorKey:"rowNumber",header:"الرقم"},{accessorKey:"identity_number",header:"هوية الطالب"},{accessorKey:"father_identity_number",header:"هوية الأب"},{accessorKey:"full_name",header:({column:l})=>{const e=l.getIsSorted();return x(f,{color:"neutral",variant:"ghost",label:"الاسم رباعي",icon:e?e==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>l.toggleSorting(l.getIsSorted()==="asc")})}},{accessorKey:"phone_number",header:"رقم الجوال"},{accessorKey:"birth_date",header:({column:l})=>ve(l,"تاريخ الميلاد"),cell:({row:l})=>l.original.birth_date},{accessorKey:"address",header:"العنوان"},{accessorKey:"masjed",header:"المسجد"},{accessorKey:"academic_class",header:"الصف الدراسي",cell:({row:l})=>{const e=l.original.academic_class;let a="";return e&&typeof e.title=="string"&&typeof e.group=="string"?a=`${e.title} - ${e.group}`:a="غير مضاف",x(K,{class:"capitalize hover:cursor-pointer hover:outline",variant:`${e?"subtle":"outline"}`,color:"neutral",onClick:y=>{y.stopPropagation(),C("academic_class",l.original)}},()=>a)}},{accessorKey:"quran_class",header:"الصف القرآني",cell:({row:l})=>{const e=l.original.quran_class;let a="";return e&&typeof e.title=="string"&&typeof e.group=="string"?a=`${e.title} - ${e.group}`:a="غير مضاف",x(K,{class:"capitalize hover:cursor-pointer hover:outline",variant:`${e?"subtle":"outline"}`,color:"neutral",onClick:y=>{y.stopPropagation(),C("quran_class",l.original)}},()=>a)}},{accessorKey:"driver",header:"السائق",cell:({row:l})=>{const e=l.original.driver;let a="";return e&&typeof e.name=="string"&&typeof e.car_type=="string"&&typeof e.car_color=="string"?a=`${e.name}`:a="لا يوجد سائق",x(K,{class:"capitalize hover:cursor-pointer hover:outline",variant:`${e?"subtle":"outline"}`,color:"neutral",onClick:y=>{y.stopPropagation(),C("driver_info",l.original)}},()=>a)}},{accessorKey:"behavioral_issues",header:"المخالفات السلوكية",cell:({row:l})=>{const e=l.original.behavioral_issues||[];return x(K,{class:`capitalize hover:cursor-pointer hover:outline ${e.length>0?"font-bold":"font-normal"} `,variant:`${e.length>0?"subtle":"soft"}`,color:`${e.length>0?"error":"success"}`,onClick:a=>{a.stopPropagation(),C("studentIssue",l.original)}},()=>`${e.length} مخالفة`)}},{id:"action"}];function C(l,e){u.value=l,w.value=!0,e&&(d.value=e)}function ge(l){return[[{label:"إضافة مخالفة سلوكية",color:"warning",icon:"i-heroicons-exclamation-triangle",onSelect:()=>{G(`/students/${l.id}/add_behavioral_issue`)}},{label:"إضافة كشف درجات",icon:"i-heroicons-academic-cap",color:"info",onSelect:()=>{G(`/students/${l.id}/add_grades_report`)}}],[{label:"Edit",icon:"i-lucide-edit",onSelect:()=>{G(`/students/${l.id}/edit_student`)}},{label:"Delete",icon:"i-lucide-trash",color:"error",onSelect:()=>{g.deleteStudent(typeof l.id=="string"?l.id:""),me.value=Math.random()}}]]}function ve(l,e){const a=l.getIsSorted();return x(pe,{content:{align:"start"},"aria-label":"Actions dropdown",items:[{label:"Asc",type:"checkbox",icon:"i-lucide-arrow-up-narrow-wide",checked:a==="asc",onSelect:()=>{a==="asc"?l.clearSorting():l.toggleSorting(!1)}},{label:"Desc",icon:"i-lucide-arrow-down-wide-narrow",type:"checkbox",checked:a==="desc",onSelect:()=>{a==="desc"?l.clearSorting():l.toggleSorting(!0)}}]},()=>x(f,{color:"neutral",variant:"ghost",label:e,icon:a?a==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5 data-[state=open]:bg-elevated","aria-label":`Sort by ${a==="asc"?"descending":"ascending"}`}))}const be=l=>new Date(l).toLocaleDateString("ar-EG",{weekday:"long"}),ye=async()=>{I.value.length!==0&&(await g.deleteMultipleStudents(I.value.filter(l=>typeof l=="string")),h.value={})},he=async()=>{!m.value||v.value.length===0||(await N.updateAcademicClassForStudents(I.value.filter(l=>typeof l=="string"),m.value),h.value={},m.value=void 0)},we=async()=>{!m.value||v.value.length===0||(await F.updateQuranClassForStudents(I.value.filter(l=>typeof l=="string"),m.value),h.value={},m.value=void 0)},Se=async()=>{!q.value||v.value.length===0||(await B.updatesDriverForStudents(I.value.filter(l=>typeof l=="string"),q.value),h.value={},q.value=void 0)};async function A(){u.value==="move_academic_class"?(await he(),await g.fetchStudents()):u.value==="move_quran_class"?(await we(),await g.fetchStudents()):u.value==="assign_driver"&&(await Se(),await g.fetchStudents()),w.value=!1}const V=k.query.driver_id,D=k.query.level,P=k.query.class_group,Q=typeof k.query.classType=="string"&&(k.query.classType==="quran"||k.query.classType==="academic")?k.query.classType:void 0,v=U(()=>Object.keys(h.value).map(l=>H.value[+l])),$e=U(()=>{if(V)return g.sortedStudents.filter(l=>V!=null&&l.driver_id===+V);if(D&&P){if(Q==="academic")return g.sortedStudents.filter(l=>{var e,a;return((e=l.academic_class)==null?void 0:e.title)===D&&String((a=l.academic_class)==null?void 0:a.group)===String(P)});if(Q==="quran")return g.sortedStudents.filter(l=>{var e,a;return((e=l.quran_class)==null?void 0:e.title)===D&&String((a=l.quran_class)==null?void 0:a.group)===String(P)})}else return D?g.sortedStudents.filter(l=>{var e;return((e=l.academic_class)==null?void 0:e.title)===D}):g.sortedStudents}),H=U(()=>($e.value??[]).map((l,e)=>({...l,rowNumber:e+1}))),I=U(()=>v.value.map(l=>l==null?void 0:l.id)),ke=U(()=>u.value==="studentIssue"?"تفاصيل المخالفات":u.value==="move_academic_class"?"نقل لصف دراسي":u.value==="move_quran_class"?"نقل لصف قرآن":u.value==="academic_class"?"تفاصيل الصف الدراسي":u.value==="quran_class"?"تفاصيل الصف القرآني":u.value==="driver_info"?"تفاصيل السائق":"");return(l,e)=>{const a=Be,y=Me,E=Ae,qe=Pe,Ce=Ee,xe=Ge;return i(),c("div",null,[n(qe,{open:s(w),"onUpdate:open":e[6]||(e[6]=p=>$(w)?w.value=p:null),title:s(ke)},{body:_(()=>{var p,L,R,O,X,Y,J,W,Z,ee,se,te,le,ae,oe,ne,re;return[s(u)==="studentIssue"?(i(),c("div",Oe,[(L=(p=s(d))==null?void 0:p.behavioral_issues)!=null&&L.length?(i(),c("div",Xe,[t("ul",null,[e[14]||(e[14]=t("li",{class:"grid grid-cols-3 justify-between items-center gap-2 border-b py-2"},[t("span",{class:"font-bold"},"اليوم"),t("span",{class:"font-bold"},"التاريخ"),t("span",{class:"font-bold"},"المخالفة")],-1)),(i(!0),c(Ue,null,Ke(s(d).behavioral_issues,(o,je)=>(i(),c("li",{key:je,class:"grid grid-cols-3 justify-between items-center gap-2 border-b border-dashed border-gray-200 py-2 mb-2"},[t("span",null,r(be(o.date+"")),1),t("span",null,r(o.date),1),t("span",null,r(o.description),1)]))),128))]),t("div",Ye,[e[15]||(e[15]=t("span",null," المجموع: ",-1)),t("span",Je,r(s(d).behavioral_issues.length),1)])])):(i(),c("p",We,"لا توجد مخالفات."))])):S("",!0),s(u)==="academic_class"?(i(),c("div",Ze,[(R=s(d))!=null&&R.academic_class?(i(),c("div",es,[t("ul",null,[e[16]||(e[16]=t("li",{class:"grid grid-cols-4 justify-between items-center gap-2 border-b py-2"},[t("span",{class:"font-bold"},"الصف"),t("span",{class:"font-bold"},"الشعبة"),t("span",{class:"font-bold"},"الطابق"),t("span",{class:"font-bold"},"الجهة")],-1)),t("li",ss,[t("span",ts,r((O=s(d))==null?void 0:O.academic_class.title),1),t("span",ls,r((X=s(d))==null?void 0:X.academic_class.group),1),t("span",as,r((Y=s(d))==null?void 0:Y.academic_class.floor),1),t("span",os,r((J=s(d))==null?void 0:J.academic_class.wing),1)])])])):(i(),c("p",ns,"لم يتم تعيين صف بعد"))])):S("",!0),s(u)==="quran_class"?(i(),c("div",rs,[(W=s(d))!=null&&W.quran_class?(i(),c("div",is,[t("ul",null,[e[17]||(e[17]=t("li",{class:"grid grid-cols-4 justify-between items-center gap-2 border-b py-2"},[t("span",{class:"font-bold"},"الصف"),t("span",{class:"font-bold"},"الشعبة"),t("span",{class:"font-bold"},"الطابق"),t("span",{class:"font-bold"},"الجهة")],-1)),t("li",ds,[t("span",cs,r((Z=s(d))==null?void 0:Z.quran_class.title),1),t("span",us,r((ee=s(d))==null?void 0:ee.quran_class.group),1),t("span",ps,r((se=s(d))==null?void 0:se.quran_class.floor),1),t("span",fs,r((te=s(d))==null?void 0:te.quran_class.wing),1)])])])):(i(),c("p",ms,"لم يتم تعيين صف بعد"))])):S("",!0),s(u)==="driver_info"?(i(),c("div",_s,[(le=s(d))!=null&&le.driver?(i(),c("div",gs,[t("ul",null,[e[18]||(e[18]=t("li",{class:"grid grid-cols-4 justify-between items-center gap-2 border-b py-2"},[t("span",{class:"font-bold"},"الاسم"),t("span",{class:"font-bold"},"نوع السيارة"),t("span",{class:"font-bold"},"لون السيارة"),t("span",{class:"font-bold"},"رقم الجوال")],-1)),t("li",vs,[t("span",bs,r((ae=s(d))==null?void 0:ae.driver.name),1),t("span",ys,r((oe=s(d))==null?void 0:oe.driver.car_type),1),t("span",hs,r((ne=s(d))==null?void 0:ne.driver.car_color),1),t("span",ws,r((re=s(d))==null?void 0:re.driver.phone_no),1)])])])):(i(),c("p",Ss,"لم يتم تعيين سائق بعد"))])):S("",!0),s(u)==="move_academic_class"?(i(),c("div",$s,[n(E,{schema:s(T),state:{selectedClassId:s(m)},class:"space-y-4",onSubmit:A},{default:_(()=>[n(y,{label:"اختر الصف الدراسي",required:"",name:"classId"},{default:_(()=>[n(a,{class:"w-full",modelValue:s(m),"onUpdate:modelValue":e[0]||(e[0]=o=>$(m)?m.value=o:null),items:s(N).classesData.map(o=>({label:`${o.title} - شعبة ${o.group}`,value:o.id})),placeholder:"اختر الصف الدراسي"},null,8,["modelValue","items"])]),_:1}),t("div",ks,[n(s(f),{type:"submit",label:"نقل",color:"secondary",loading:s(N).loading,class:"w-30 flex justify-center mt-5 hover:cursor-pointer font-bold"},null,8,["loading"]),n(s(f),{label:"إلغاء",color:"neutral",variant:"soft",class:"w-30 flex justify-center mt-5 hover:cursor-pointer",onClick:e[1]||(e[1]=o=>w.value=!1)})])]),_:1},8,["schema","state"])])):S("",!0),s(u)==="move_quran_class"?(i(),c("div",qs,[n(E,{schema:s(T),state:{selectedClassId:s(m)},class:"space-y-4",onSubmit:A},{default:_(()=>[n(y,{label:"اختر صف القرآن",required:"",name:"classId"},{default:_(()=>[n(a,{class:"w-full",modelValue:s(m),"onUpdate:modelValue":e[2]||(e[2]=o=>$(m)?m.value=o:null),items:s(F).classesData.map(o=>({label:`${o.title} - شعبة ${o.group}`,value:o.id})),placeholder:"اختر صف القرآن"},null,8,["modelValue","items"])]),_:1}),t("div",Cs,[n(s(f),{type:"submit",label:"نقل",color:"secondary",loading:s(F).loading,class:"w-30 flex justify-center mt-5 hover:cursor-pointer font-bold"},null,8,["loading"]),n(s(f),{label:"إلغاء",color:"neutral",variant:"soft",class:"w-30 flex justify-center mt-5 hover:cursor-pointer",onClick:e[3]||(e[3]=o=>w.value=!1)})])]),_:1},8,["schema","state"])])):S("",!0),s(u)==="assign_driver"?(i(),c("div",xs,[n(E,{schema:s(z),state:{selectedDriverId:s(q)},class:"space-y-4",onSubmit:A},{default:_(()=>[n(y,{label:"اختر السائق",required:"",name:"driverId"},{default:_(()=>[n(a,{class:"w-full",modelValue:s(q),"onUpdate:modelValue":e[4]||(e[4]=o=>$(q)?q.value=o:null),items:s(B).driversData.map(o=>({label:`${o.name} - ${o.car_type} - ${o.car_color}`,value:o.id})),placeholder:"اختر السائق"},null,8,["modelValue","items"])]),_:1}),t("div",js,[n(s(f),{type:"submit",label:"تعيين",color:"secondary",loading:s(B).loading,class:"w-30 flex justify-center mt-5 hover:cursor-pointer font-bold"},null,8,["loading"]),n(s(f),{label:"إلغاء",color:"neutral",variant:"soft",class:"w-30 flex justify-center mt-5 hover:cursor-pointer",onClick:e[5]||(e[5]=o=>w.value=!1)})])]),_:1},8,["schema","state"])])):S("",!0)]}),_:1},8,["open","title"]),t("div",Ds,[n(Te,{duration:300,mode:"out-in",name:"fade"},{default:_(()=>[n(Ce,{icon:"i-lucide-search",size:"md",color:"secondary",variant:"outline",modelValue:s(j),"onUpdate:modelValue":e[7]||(e[7]=p=>$(j)?j.value=p:null),placeholder:"البحث عن طالب...",class:"w-full md:col-span-4"},null,8,["modelValue"]),s(v).length?(i(),c("div",Is,[n(s(f),{icon:"heroicons-trash",variant:"outline",color:"error",size:"xs",class:"p-2 font-bold h-full",loading:s(g).loading,onClick:ye},{default:_(()=>[e[19]||(e[19]=t("span",null,"حذف",-1)),t("span",null,"("+r(s(v).length)+")",1)]),_:1,__:[19]},8,["loading"]),n(s(f),{icon:"i-heroicons-arrow-right-on-rectangle",variant:"outline",color:"info",size:"xs",class:"p-2 font-bold h-full",onClick:e[8]||(e[8]=p=>C("move_quran_class"))},{default:_(()=>[e[20]||(e[20]=t("span",null,"نقل",-1)),e[21]||(e[21]=t("span",null,"لصف",-1)),e[22]||(e[22]=t("span",null,"قرآن",-1)),t("span",null,"("+r(s(v).length)+")",1)]),_:1,__:[20,21,22]}),n(s(f),{icon:"i-heroicons-arrow-right-on-rectangle",variant:"outline",color:"info",size:"xs",class:"p-2 font-bold h-full",onClick:e[9]||(e[9]=p=>C("move_academic_class"))},{default:_(()=>[e[23]||(e[23]=t("span",null,"نقل",-1)),e[24]||(e[24]=t("span",null,"لصف",-1)),e[25]||(e[25]=t("span",null,"دراسي",-1)),t("span",null,"("+r(s(v).length)+")",1)]),_:1,__:[23,24,25]}),n(s(f),{icon:"lucide-car-taxi-front",variant:"outline",color:"warning",size:"xs",class:"p-2 font-bold h-full",onClick:e[10]||(e[10]=p=>C("assign_driver"))},{default:_(()=>[e[26]||(e[26]=t("span",null,"تعيين",-1)),e[27]||(e[27]=t("span",null,"سائق",-1)),t("span",null,"("+r(s(v).length)+")",1)]),_:1,__:[26,27]}),n(s(f),{icon:"heroicons-document-chart-bar-solid",variant:"outline",color:"primary",size:"xs",class:"p-2 font-bold text-green-700 h-full"},{default:_(()=>[t("span",null,"("+r(s(v).length)+")",1),e[28]||(e[28]=t("span",null," Excel ",-1))]),_:1,__:[28]}),n(s(f),{icon:"heroicons-document-chart-bar-solid",variant:"outline",color:"secondary",size:"sm",class:"p-2 font-bold text-blue-700 h-full"},{default:_(()=>[t("span",null,"("+r(s(v).length)+")",1),e[29]||(e[29]=t("span",null," PDF ",-1))]),_:1,__:[29]})])):S("",!0)]),_:1})]),(i(),ce(xe,{loading:s(g).loading,key:s(g).tableKey,"global-filter":s(j),"onUpdate:globalFilter":e[11]||(e[11]=p=>$(j)?j.value=p:null),"row-selection":s(h),"onUpdate:rowSelection":e[12]||(e[12]=p=>$(h)?h.value=p:null),ref:s(fe),data:s(H),columns:_e,sorting:s(M),"onUpdate:sorting":e[13]||(e[13]=p=>$(M)?M.value=p:null),"get-dropdown-actions":ge},null,8,["loading","global-filter","row-selection","data","sorting"]))])}}}),Ks={};function Vs(ue,T){const z=Us;return i(),ce(z)}const lt=ze(Ks,[["render",Vs]]);export{lt as default};
