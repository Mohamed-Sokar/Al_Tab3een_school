import{ae as x,v as f,g as p}from"./Bdt3oPQx.js";import{u as C}from"./BV0LrqSL.js";import{u as E}from"./CnqViFtj.js";import{a as c}from"./CdmufGkO.js";const $=x("drivers",()=>{const u=C(),{toastError:i,toastSuccess:n}=E(),a=f([]),s=f(!1),g=p(()=>a.value),d=p(()=>a.value.map(t=>{const e=u.sortedStudents.filter(r=>r.driver_id===t.id).length;return{...t,studentsCount:e}})),y=async()=>{s.value=!0;try{const{data:t}=await c.get("/drivers");console.log(t),a.value=t,n({title:"تم تحميل السائقين بنجاح"})}catch(t){i({title:"حدث مشكلة أثناء تحميل السائقين",description:t instanceof Error?t.message:typeof t=="string"?t:JSON.stringify(t)})}finally{s.value=!1}},S=async t=>{s.value=!0;try{const{data:e}=await c.post("/drivers",t);n({title:":تم إضافة السائق بنجاح"}),console.log(e),a.value.unshift({...t})}catch(e){i({title:"حدث مشكلة في إضافة السائق",description:e instanceof Error?e.message:typeof e=="string"?e:JSON.stringify(e)})}finally{s.value=!1}},m=async t=>{try{s.value=!0,await c.delete(`drivers/${t}`),n({title:":تم حذف السائق بنجاح"});const e=l(t);a.value.splice(e,1)}catch(e){i({title:"حدث مشكلة في حذف السائق",description:e instanceof Error?e.message:typeof e=="string"?e:JSON.stringify(e)})}finally{s.value=!1}},D=async(t,e)=>{try{s.value=!0;const{data:r}=await c.put(`drivers/${t}`,e);n({title:":تم تحديث بيانات السائق بنجاح"}),console.log(r);const o=l(t),h=v(t);a.value[o]={...h,...e}}catch(r){i({title:"حدث مشكلة في تعديل بيانات السائق",description:r instanceof Error?r.message:typeof r=="string"?r:JSON.stringify(r)})}finally{s.value=!1}},v=t=>a.value.find(e=>e.id===t),l=t=>a.value.findIndex(e=>e.id===t);return{loading:s,driversData:g,driversWithStudentsCount:d,fetchDrivers:y,addDriver:S,updateDriver:D,deleteDriver:m,getSpecificDriver:v,getSpecificDriverIndex:l,driverStudentsCount:t=>{var e;return(e=d.value.find(r=>r.id===t))==null?void 0:e.studentsCount},updatesDriverForStudents:async(t,e)=>{try{s.value=!0;const{data:r}=await c.put("/drivers/update-driver",{studentIds:t,driverId:e});console.log(r),n({title:"تم تعيين سائق للطلاب بنجاح"}),u.studentsData=u.studentsData.map(o=>t.includes(o.id||"")?{...o,driver_id:e}:o)}catch{i({title:"فشل في تعيين السائق"})}finally{s.value=!1}}}});export{$ as u};
