import{a3 as U,v as _,g as k,c as x,a as i,b as o,w as v,j as u,Y as A,o as E,a4 as $}from"./Bdt3oPQx.js";import{_ as B}from"./TqmmhZlW.js";import{u as S}from"./E7VpxlTN.js";import{u as C}from"./CnqViFtj.js";import"./CwNombFT.js";const N={class:"mb-4"},F={class:"mb-4"},q={__name:"avatar",setup(I){const l=S(),b=U(),{toastSuccess:h,toastError:d}=C(),t=_(!1),n=_(),g=k(()=>"/images/avatar.avif"),w=async()=>{var a,r;const e=n.value.files[0];if(!e){d({title:"Select a file to upload first"});return}const p=e.name.split(".").pop(),c=`${Math.random()}.${p}`;try{t.value=!0;const s=(r=(a=b.value)==null?void 0:a.user_metadata)==null?void 0:r.avatar_url,{data:y,error:f}=await l.storage.from("avatars").upload(c,e);if(f)throw f;if(await l.auth.updateUser({data:{avatar_url:y.path}}),s){const{error:m}=await l.storage.from("avatars").remove([s]);if(m)throw m}n.value.value="",h({title:"Avatar uploaded"})}catch(s){d({title:"Error uploading avatar",description:s.message})}finally{t.value=!1}};return(e,p)=>{const c=$,a=B,r=A;return E(),x("div",null,[i("div",N,[o(a,{label:"الصورة الشخصية الحالية",class:"w-full"},{default:v(()=>[o(c,{src:u(g),class:"w-30 h-30 border"},null,8,["src"])]),_:1})]),i("div",F,[o(a,{label:"اختر صورة جديدة",class:"w-full",name:"avatar",help:"بعد اختيارك للصورة اضغط على زر حفظ ليتم حفظ الصورة الجديدة"},{default:v(()=>[i("input",{type:"file",ref_key:"fileInput",ref:n,class:"py-1.5 px-2 w-80 rounded-md border border-gray-300 dark:border-gray-600"},null,512)]),_:1})]),o(r,{type:"submit",color:"secondary",variant:"solid",label:"حفظ",loading:u(t),disabled:u(t),onClick:w},null,8,["loading","disabled"])])}}};export{q as default};
