import{ae as Y,v as b,g}from"./Bdt3oPQx.js";import{u as Z}from"./CnqViFtj.js";import{a as h}from"./CdmufGkO.js";const se=Y("teachers",()=>{const{toastSuccess:o,toastError:u}=Z(),r=b([]),c=b(!1),p=b([]),_=b([]),y=b([]),w=b(Math.random()),A=g(()=>r.value.sort((e,a)=>(e.full_name??"").localeCompare(a.full_name??""))),R=g(()=>p.value.sort((e,a)=>(e.teacher_name??"").localeCompare(a.teacher_name??""))),L=g(()=>_.value.sort((e,a)=>(a.amount??0)-(e.amount??0))),B=g(()=>y.value.sort((e,a)=>new Date(a.date||new Date).getTime()-new Date(e.date||new Date).getTime())),M=async()=>{c.value=!0;try{const{data:e}=await h.get("/teachers");console.log(e),r.value=e,o({title:"تم تحميل المعلمين بنجاح"}),w.value=Math.random()}catch{throw u({title:"هناك مشكلة في تحميل المعلمين",description:"تحقق من الاتصال بالنترنت"}),new Error("خطأ في تحميل المعلمين")}finally{c.value=!1}},O=async e=>{try{c.value=!0;const{data:a}=await h.post("/teachers",e);o({title:`:تم إضافة المعلم ${a[0].full_name} بنجاح`}),r.value.unshift({...e})}catch(a){throw u({title:"حدث مشكلة في إضافة المعلم",description:"تحقق من الاتصال بالنترنت"}),Error(a instanceof Error?a.message:String(a))}finally{c.value=!1}},j=async(e,a)=>{try{c.value=!0;const t=V(a),{data:s}=await h.put(`teachers/${e}`,t);o({title:`:تم تحديث بيانات المعلم ${s[0].full_name} بنجاح`});const n=m(e),l=v(e);if(r.value&&n!==-1&&l){l.teachers_behavioral_issues||(l.teachers_behavioral_issues=[]);const i=r.value[n].teachers_behavioral_issues;i&&(r.value[n]={...s[0],teachers_behavioral_issues:i})}r.value[n]={...l,...a}}catch(t){throw u({title:"حدث مشكلة في تعديل المعلم",description:"تحقق من الاتصال بالنترنت"}),Error(t instanceof Error?t.message:String(t))}finally{c.value=!1}},C=async e=>{try{c.value=!0;const{data:a}=await h.delete(`teachers/${e}`);o({title:`:تم حذف المعلم ( ${a[0].full_name} ) بنجاح`}),console.log(a);const t=m(e);r.value.splice(t,1)}catch{throw u({description:"تحقق من الاتصال بالنترنت",title:"حدث مشكلة في حذف المعلم"}),Error("حدث مشكلة في حذف المعلم")}finally{c.value=!1}},v=e=>r.value.find(a=>a.id===e),m=e=>r.value.findIndex(a=>a.id===e),F=async()=>{c.value=!0;try{const{data:e}=await h.get("/teachers/behavioral-issues");console.log(e),p.value=e,o({title:"تم تحميل المخالفات بنجاح"})}catch(e){throw u({title:e.message,description:"تحقق من الاتصال بالنترنت"}),Error(e instanceof Error?e.message:String(e))}finally{c.value=!1}},K=async(e,a)=>{const t=v(e);if(!t)return;const s={teacher_id:t.id,teacher_name:t==null?void 0:t.full_name,description:a,date:new Date().toISOString().split("T")[0]};try{c.value=!0;const{data:n}=await h.post("/teachers/behavioral-issues",s);console.log(n),o({title:"تم إضافة المخالفة السلوكية"}),r.value&&t&&(t.teachers_behavioral_issues||(t.teachers_behavioral_issues=[]),t.teachers_behavioral_issues.push({id:n[0].id,...s})),p.value.unshift(n[0])}catch{u({title:"حدث مشكلة في إضافة المخالفة السلوكية",description:"تحقق من الاتصال بالنترنت"})}finally{c.value=!1}},U=async(e,a)=>{var t;try{c.value=!0;const s=S(e),n=T(e),l=m((n==null?void 0:n.teacher_id)??""),i=v((n==null?void 0:n.teacher_id)??""),{data:d}=await h.put(`/teachers/behavioral-issues/${e}`,{description:a});if(console.log(d),p.value[s]={...p.value[s],description:a},r.value&&r.value[l]&&r.value[l].teachers_behavioral_issues){const f=((t=i==null?void 0:i.teachers_behavioral_issues)==null?void 0:t.findIndex(x=>x.id===e))||0;r.value[l].teachers_behavioral_issues[f].description=a}w.value=Math.random(),o({title:"تم تعديل المخالفة بنجاح"})}catch(s){throw u({title:"حدثت مشكلة أثناء تعديل المخالفة",description:"تحقق من الاتصال بالنترنت"}),Error(s instanceof Error?s.message:String(s))}finally{c.value=!1}},k=async e=>{var n,l;const a=T(e),t=S(e),s=v((a==null?void 0:a.teacher_id)??"");try{c.value=!0;const{data:i}=await h.delete(`teachers/behavioral-issues/${e}`);if(o({title:":تم حذف المخالفة بنجاح"}),console.log(i),p.value.splice(t,1),s){const d=(n=s.teachers_behavioral_issues)==null?void 0:n.findIndex(f=>f.id===e);(l=s.teachers_behavioral_issues)==null||l.splice(d??0,1)}}catch{u({title:"حدث مشكلة في حذف المخالفة",description:"تحقق من الاتصال بالنترنت"})}finally{c.value=!1}},T=e=>p.value.find(a=>a.id===e),S=e=>p.value.findIndex(a=>a.id===e),q=async()=>{c.value=!0;try{const{data:e}=await h.get("/teachers/loans");console.log(e),_.value=e,o({title:"تم تحميل السلف بنجاح"})}catch(e){throw u({title:"حدث مشكلة في تحميل السلف",description:"تحقق من الاتصال بالنترنت"}),Error(e instanceof Error?e.message:String(e))}finally{c.value=!1}},z=async(e,a)=>{const t=v(e);if(!t)return;const s={teacher_id:t.id,teacher_name:t==null?void 0:t.full_name,amount:a,date:new Date().toISOString().split("T")[0]};try{c.value=!0;const{data:n}=await h.post("/teachers/loans",s);console.log(n),o({title:"تم إضافة السلفة"}),r.value&&t&&(t.teachers_loans||(t.teachers_loans=[]),t.teachers_loans.unshift({id:n[0].id,...s})),_.value.unshift(n[0])}catch{u({title:"حدث مشكلة في إضافة السلفة",description:"تحقق من الاتصال بالنترنت"})}finally{c.value=!1}},G=async(e,a)=>{var t;try{c.value=!0;const s=E(e),n=I(e),l=m((n==null?void 0:n.teacher_id)??""),i=v((n==null?void 0:n.teacher_id)||""),{data:d}=await h.put(`/teachers/loans/${e}`,{amount:a});if(console.log(d),_.value[s]={..._.value[s],amount:a},r.value&&r.value[l]&&r.value[l].teachers_loans){const f=((t=i==null?void 0:i.teachers_loans)==null?void 0:t.findIndex(x=>x.id===e))||0;r.value[l].teachers_loans[f].amount=a}w.value=Math.random(),o({title:"تم تعديل السلفة بنجاح"})}catch(s){throw u({title:"حدثت مشكلة أثناء تعديل السلفة",description:"تحقق من الاتصال بالنترنت"}),Error(s instanceof Error?s.message:String(s))}finally{c.value=!1}},H=async e=>{var n,l;const a=I(e),t=E(e),s=v((a==null?void 0:a.teacher_id)??"");try{c.value=!0;const{data:i}=await h.delete(`teachers/loans/${e}`);if(o({title:":تم حذف السلفة بنجاح"}),console.log(i),_.value.splice(t,1),s){const d=(n=s.teachers_loans)==null?void 0:n.findIndex(f=>f.id===e);(l=s.teachers_loans)==null||l.splice(d??0,1)}}catch{u({title:"حدث مشكلة في حذف السلفة",description:"تحقق من الاتصال بالنترنت"})}finally{c.value=!1}},I=e=>_.value.find(a=>a.id===e),E=e=>_.value.findIndex(a=>a.id===e),J=async()=>{c.value=!0;try{const{data:e}=await h.get("/teachers/absence");console.log(e),y.value=e,o({title:"تم تحميل تقارير الغياب بنجاح"})}catch(e){u({title:"حدث مشكلة في تحميل تقارير الغياب",description:e.message})}finally{c.value=!1}},N=async(e,a)=>{const t=v(e);if(!t)return;const s={teacher_id:t.id,teacher_name:t==null?void 0:t.full_name,reason:a.reason,excuse_status:a.excuse_status,date:a.date};try{c.value=!0;const{data:n}=await h.post("/teachers/absence",s);console.log(n),o({title:"تم إضافة التقرير"}),r.value&&t&&(t.teachers_absence||(t.teachers_absence=[]),t.teachers_absence.unshift({id:n[0].id,...s})),y.value.unshift(n[0])}catch(n){u({title:"حدث مشكلة في إضافة التقرير",description:n.message})}finally{c.value=!1}},P=async e=>{var n,l;const a=D(e),t=$(e),s=v((a==null?void 0:a.teacher_id)??"");try{c.value=!0;const{data:i}=await h.delete(`teachers/absence/${e}`);if(o({title:":تم حذف التقرير بنجاح"}),console.log(i),y.value.splice(t,1),s){const d=(n=s.teachers_absence)==null?void 0:n.findIndex(f=>f.id===e);(l=s.teachers_loans)==null||l.splice(d??0,1)}}catch(i){u({title:"حدث مشكلة في حذف التقرير",description:i.message})}finally{c.value=!1}},Q=async(e,a)=>{var t;try{c.value=!0;const s=D(e),n=$(e),l=m((s==null?void 0:s.teacher_id)??""),i=v((s==null?void 0:s.teacher_id)||""),{data:d}=await h.put(`/teachers/absence/${e}`,{...s,...a});if(console.log(d),y.value[n]={...y.value[n],...a},r.value&&r.value[l]&&r.value[l].teachers_absence){const f=((t=i==null?void 0:i.teachers_absence)==null?void 0:t.findIndex(x=>x.id===e))||0;r.value[l].teachers_absence[f]=d[0]}w.value=Math.random(),o({title:"تم تعديل التقرير بنجاح"})}catch(s){u({title:"حدثت مشكلة أثناء تعديل التقرير",description:s.message})}finally{c.value=!1}},D=e=>y.value.find(a=>a.id==e),$=e=>y.value.findIndex(a=>a.id===e);function V(e){const a=["id","full_name","identity_number","phone_number","birth_date","subject","created_at"];return Object.fromEntries(Object.entries(e).filter(([t])=>a.includes(t)))}const W=g(()=>e=>teachersUpsentReportsData.value.filter(a=>a.teacher_id===e).length),X=g(()=>e=>_.value.reduce((a,t)=>t.teacher_id===e?a+t.amount:a,0));return{teachersData:r,behavioralIssuesTeachersData:p,teachersLoansData:_,teachersAbsenceReportsData:y,loading:c,fetchTeachers:M,addTeacher:O,updateTeacher:j,deleteTeacher:C,getSpesificTeacher:v,getSpesificTeacherIndex:m,fetchTeachersBehavioralIssues:F,addTeacherBehavioralIssue:K,editTeacherBehavioralIssue:U,deleteTeacherBehavioralIssue:k,getSpesificTeacherBehavioralIssue:T,getSpesificTeacherBehavioralIssueIndex:S,fetchTeachersLoans:q,addTeacherLoan:z,editTeacherLoan:G,deleteTeacherLoan:H,getSpesificTeacherLoan:I,getSpesificTeacherLoanIndex:E,fetchAbsenceReports:J,addTeacherAbsenceReport:N,editTeacherAbsenceReport:Q,deleteTeacherAbsenceReport:P,getSpesificTeacherAbsenceReport:D,getSpesificTeacherAbsenceReportIndex:$,totalTeacherAbsence:W,totalTeacherLoans:X,sortedTeachers:A,sortedLoans:L,sortedIssues:R,sortedAbsenceReports:B}});export{se as u};
