import{ae as F,v as h,g as S}from"./Bdt3oPQx.js";import{u as T}from"./CnqViFtj.js";import{s as A}from"./CehikpY4.js";import{a as o}from"./CdmufGkO.js";const H=F("students",()=>{const{toastSuccess:u,toastError:d}=T(),n=h(A),i=h(),a=h(!1),v=h(Math.random()),g=S(()=>[...n.value??[]].sort((e,t)=>(e.full_name??"").localeCompare(t.full_name??""))),p=S(()=>[...i.value??[]].sort((e,t)=>(e.student_name??"").localeCompare(t.student_name??""))),b=async()=>{a.value=!0;try{const{data:e}=await o.get("/students");console.log(e),n.value=e,u({title:"تم تحميل الطلاب بنجاح"}),v.value=Math.random()}catch{throw d({title:"هناك مشكلة في تحميل الطلاب"}),new Error}finally{a.value=!1}},w=async e=>{a.value=!0;try{const{data:t}=await o.post("/students",e);u({title:`:تم إضافة الطالب ${t[0].full_name} بنجاح`}),(n.value||[]).unshift({...e})}catch(t){throw d({title:"حدث مشكلة في إضافة الطالب"}),Error(t instanceof Error?t.message:String(t))}finally{a.value=!1}},I=async(e,t)=>{try{a.value=!0;const s=z(t),{data:l}=await o.put(`students/${e}`,s);u({title:`:تم تحديث بيانات الطالب ${l[0].full_name} بنجاح`});const r=f(e);if(n.value&&r!==-1){const c=n.value[r].students_behavioral_issues;n.value[r]={...l[0],students_behavioral_issues:c}}}catch(s){throw d({title:"حدث مشكلة في تعديل الطالب"}),Error(s instanceof Error?s.message:String(s))}finally{a.value=!1}},x=async e=>{try{a.value=!0;const{data:t}=await o.delete(`students/${e}`);u({title:`:تم حذف الطالب ( ${t[0].full_name} ) بنجاح`});const s=f(e);(n.value||[]).splice(s,1)}catch{d({title:"حدث مشكلة في حذف الطالب"})}finally{a.value=!1}},E=async e=>{try{a.value=!0,await o.delete("/students/delete-many",{data:{ids:e}}),n.value=n.value.filter(t=>!e.includes(t.id||"")),u({title:"تم حذف الطلاب بنجاح"})}catch{d({title:"فشل في حذف الطلاب"})}finally{a.value=!1}},_=e=>{var t;return(t=n.value)==null?void 0:t.find(s=>s.id===e)},f=e=>n.value.findIndex(t=>t.id===e),$=async()=>{a.value=!0;try{const{data:e}=await o.get("/students/behavioral-issues");console.log(e),i.value=e,u({title:"تم تحميل المخالفات بنجاح"}),v.value=Math.random()}catch(e){throw Error(e instanceof Error?e.message:String(e))}finally{a.value=!1}},B=async(e,t)=>{const s=_(e);if(!s)return;const l={student_id:s.id,level:s.level,class_group:s.class_group,description:t,student_name:s==null?void 0:s.full_name,date:new Date().toISOString().split("T")[0]};try{a.value=!0;const{data:r}=await o.post("/students/behavioral-issues",l);u({title:"تم إضافة المخالفة السلوكية"}),n.value&&s&&(s.students_behavioral_issues||(s.students_behavioral_issues=[]),s.students_behavioral_issues.push({id:r[0].id,...l})),(i.value||[]).unshift(r[0])}catch{d({title:"حدث مشكلة في إضافة المخالفة السلوكية"})}finally{a.value=!1}},M=async(e,t)=>{try{a.value=!0;const s=y(e),l=m(e);console.log(s);const{data:r}=await o.put(`/students/behavioral-issues/${e}`,{...(i.value||[])[s],description:t});(i.value||[])[s]={...(i.value||[])[s],description:t};const c=f((l==null?void 0:l.student_id)??"");n.value&&n.value[c]&&n.value[c].students_behavioral_issues&&(n.value[c].students_behavioral_issues[s].description=t),v.value=Math.random(),u({title:"تم تعديل المخالفة بنجاح"})}catch(s){throw d({title:"حدثت مشكلة أثناء تعديل المخالفة"}),Error(s instanceof Error?s.message:String(s))}finally{a.value=!1}},j=async e=>{var r,c;const t=m(e),s=y(e),l=_((t==null?void 0:t.student_id)||"");try{a.value=!0;const{data:D}=await o.delete(`students/behavioral-issues/${e}`);if(u({title:":تم حذف المخالفة بنجاح"}),(i.value||[]).splice(s,1),l){const O=(r=l.students_behavioral_issues)==null?void 0:r.findIndex(C=>C.id===e);(c=l.students_behavioral_issues)==null||c.splice(O??0,1)}}catch{d({title:"حدث مشكلة في حذف المخالفة"})}finally{a.value=!1}},m=e=>p.value.find(t=>t.id===e),y=e=>(i.value??[]).findIndex(t=>t.id!==void 0&&+t.id==+e);function z(e){const t=["id","full_name","identity_number","father_identity_number","phone_number","birth_date","level","masjed","address","memorization_status","memorized_juz","daily_recitation","class_group","created_at"];return Object.fromEntries(Object.entries(e).filter(([s])=>t.includes(s)))}return{studentsData:n,loading:a,behavioralIssuesStudentData:i,tableKey:v,sortedStudents:g,sortedIssues:p,fetchStudents:b,fetchBehavioralIssues:$,addStudent:w,editStudent:I,deleteStudent:x,deleteMultipleStudents:E,getSpesificStudent:_,getSpesificStudentIndex:f,addStudentBehavioralIssue:B,editStudentBehavioralIssue:M,deleteStudentBehavioralIssue:j,getSpesificStudentBehavioralIssue:m,getSpesificStudentBehavioralIssueIndex:y}});export{H as u};
